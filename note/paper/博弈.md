# 博弈

- [博弈](#博弈)
- [博弈基础](#博弈基础)
  - [组合游戏](#组合游戏)
  - [Bash游戏](#bash游戏)
  - [PN态](#pn态)
  - [技巧总结](#技巧总结)
  - [Nim游戏](#nim游戏)
  - [Nim游戏扩展](#nim游戏扩展)
  - [反常Nim游戏](#反常nim游戏)
  - [不平等游戏](#不平等游戏)
- [Sprague-Grudy函数](#sprague-grudy函数)
  - [图游戏](#图游戏)
  - [SG函数](#sg函数)
  - [图游戏的和](#图游戏的和)
  - [SG 定理](#sg-定理)
  - [分裂游戏](#分裂游戏)
  - [隐藏的Nim](#隐藏的nim)
  - [取苹果游戏](#取苹果游戏)
  - [树上的$Green Hackenbush$游戏](#树上的green-hackenbush游戏)
- [经典组合游戏](#经典组合游戏)
  - [Fibonacci Nim游戏](#fibonacci-nim游戏)
  - [Chomp游戏](#chomp游戏)
  - [Wythoff游戏](#wythoff游戏)
  - [二分图博弈](#二分图博弈)
    - [博弈与二分图最大匹配](#博弈与二分图最大匹配)
    - [二分图博弈在一般图的扩展](#二分图博弈在一般图的扩展)
    - [二分图最大匹配非必需点的寻找](#二分图最大匹配非必需点的寻找)
  - [有向图博弈技巧](#有向图博弈技巧)
- [Nim积](#nim积)
  - [翻硬币游戏](#翻硬币游戏)
  - [二维翻硬币游戏](#二维翻硬币游戏)
  - [Nim积](#nim积-1)
  - [Nim积的计算](#nim积的计算)
    - [基本计算方法](#基本计算方法)
    - [更快的计算方式](#更快的计算方式)
  - [Nim积下的逆元](#nim积下的逆元)
  - [Nim积的其他结论](#nim积的其他结论)
  - [Nim积对应的组合游戏](#nim积对应的组合游戏)

# 博弈基础
## 组合游戏
- 两个玩家，一个状态集合。
- 游戏规则指明了状态转移方式。
- 初始状态开始，玩家轮流移动，直到当前状态没有后继状态时游戏结束（一般是有限步内）。

此模型可以抽象为一个 $DAG$，状态集合代表点集，游戏规则指定了边集。

## Bash游戏
> 一堆大小为 $n$ 的石子，两玩家轮流去石子，每次取走 $1 \sim 3$ 个，无法操作的玩家输。在双方都绝顶聪明的情况下，问先手是否获胜。

结论：先手获胜 $\iff$ $n \% 4 > 0$。


## PN态
相关概念：
1. $Previous$ $position$ 状态：上一步移动到此状态的玩家能获得胜利。
2. $Next$ $position$ 状态：从此状态移动的的玩家能获得胜利。
3. 正常规则：不能移动的人输掉游戏。
4. 反常规则：不能移动的人获胜。

结论：
1. 在正常规则下，不能移动的状态是 $P$ 态，由此可以反推前驱节点的状态；在反常规则下，不能移动的状态是 $N$ 态。
2. 当前状态是 $N$ 态 $\iff$ 存在后继状态是 $P$ 态。
3. 当前状态是 $P$ 态 $\iff$ 无后继或者后继状态全是 $N$ 态。

## 技巧总结
1. 对 $PN$ 态打表找规律，可以使用搜索或者 $DP$。
2. 猜结论。
3. 推导证明 $PN$ 态。

## Nim游戏
> $n$ 堆石子个数分别为 $x_1,x_2,\dots,x_n$，两人轮流取石子，每次选取某一堆，取走任意数量的石子，无法操作的人输掉游戏。

结论
1. 石子状态 $x_1,x_2,\dots,x_n$ 是 $P$ 态 $\iff$ $x_1 \oplus x_2 \dots \oplus x_n = 0$；
2. 石子状态 $x_1,x_2,\dots,x_n$ 是 $N$ 态 $\iff$ $x_1 \oplus x_2 \dots \oplus x_n > 0$。

证明上述 $P$ 态只能到达 $N$ 态
反证法，不妨假设玩家选择取第一堆石子使得 $P$ 态到达 $P$ 态，即 $x_1 \rightarrow x_1^{'}$，而 $x_1 \oplus x_2 \dots \oplus x_n = x_1^{'} \oplus x_2 \dots \oplus x_n = 0$，那么 $x_1 = x_1^{'}$，这与游戏规则矛盾，这说明 $P$ 态不能到达 $P$ 态。

证明上述 $N$ 态能到达 $P$ 态
设 $x_1 \oplus x_2 \dots \oplus x_n = t > 0$，$t$ 的最高位为 $w$，那么玩家可以在 $x_1 \sim x_n$ 中寻找一个 $w$ 位为 $1$ 的 $x_i$（可以反证这样的 $x_i$ 必定存在），取该堆石子使得 $x_i \rightarrow x_i \oplus t$（上述选取方式保证了 $x_i > x_i \oplus t$），取完石子后的状态满足，$x_1 \oplus x_2 \dots (x_i \oplus t) \dots \oplus x_n = 0$，是 $P$ 态。

## Nim游戏扩展
> 对 $Nim$ 游戏添加限制，每次取走的石子数在 $[l,r]$ 之中。

解决方法
在此规则下，一堆大小为 $x$ 的石子 $SG$ 函数为 $sg(x) = \lfloor \frac{x\%(l+r)}{l} \rfloor$，当前态为 $N$ 态 $\iff$ $sg(x_1) \oplus sg(x_2) \oplus \dots \oplus sg(x_n) > 0$。

## 反常Nim游戏
> $n$ 堆石子个数分别为 $x_1,x_2,\dots,x_n$，两人轮流取石子，每次选取某一堆，取走任意数量的石子，无法操作的人**获胜**。

结论
1. 若 $x_1 = x_2 = \dots = x_n = 1$，并且 $n$ 是奇数，当前为 $P$ 态。
2. 若 $x_1 = x_2 = \dots = x_n = 1$，并且 $n$ 是偶数，当前为 $N$ 态。
3. 若不满足 $x_1 = x_2 = \dots = x_n = 1$，并且 $x_1 \oplus x_2 \dots \oplus x_n = 0$，当前为 $P$ 态。
4. 若不满足 $x_1 = x_2 = \dots = x_n = 1$，并且 $x_1 \oplus x_2 \dots \oplus x_n > 0$，当前为 $N$ 态。

## 不平等游戏
在组合游戏 $DAG$ 模型下
1. 平等游戏：两玩家能操作的边集相同
2. 不平等游戏：两玩家能操作的边集不同

例如不平等的 $Bash$ 游戏：$n$ 个石子，规定先手每次取 $1\sim 3$ 个，而后手每次取 $1 \sim 2$ 个。

# Sprague-Grudy函数
## 图游戏
图游戏是对组合游戏的一种抽象描述。
给定一个有向图 $G = (V,E)$，从起始节点 $x_0$ 开始，两玩家轮流移动。
把 $x$ 可以下一步可以移动到的节点集合记为 $F(x)$。
若 $F(x)$ 为空集，那么 $x$ 为终止节点，此时玩家无法操作，游戏结束。

## SG函数
定义有向无环图 $G = (V,E)$ 的 $SG$ 函数是一个映射 $g:V \rightarrow Z_{\ge 0}$，满足
$$
g(x) = mex\{g(y) | y \in F(x)\}
$$

一个结论：设图中边数为 $m$，那么图中所有节点的 $SG$ 函数大小不超过 $\sqrt m$。

与 $PN$ 态的联系
1. $x$ 是 $P$ 态 $\iff$ $g(x) = 0$
2. $x$ 是 $N$ 态 $\iff$ $g(x) > 0$

## 图游戏的和
假设给定 $n$ 个有向无环图 $G_i(V_i,E_i)$，则图游戏的和 $G(V,E)$ 满足
- $V = V_1 \times V_2 \times \dots \times V_n$，即笛卡尔积，各个游戏状态的组合。
- 节点 $x = (x_1,x_2,\dots,x_n)$ 的后继节点集合 $F(x) = \bigcup_{i=1}^n \{(x_1,\dots,y_i,\dots,x_n) | y_i \in F_i(x_i)\}$

记 $G = G_1 + G_2 + \dots + G_n$。

## SG 定理
假设有 $n$ 个组合游戏 $G_1,\dots,G_n$，记 $g_i$ 为 $G_i$ 上的 $SG$ 函数，则它们的和 $G = G_1 + G_2 + \dots + G_n$ 的 $SG$ 函数为
$$
    g(x) = g((x_1,x_2,\dots,x+n)) = g_1(x_1) \oplus g_2(x_2) \oplus \dots \oplus g_n(x_n)
$$

## 分裂游戏
> 又称 $Lasker's Nim$。$n$ 堆石子，每次玩家可以选择
> 1. 从一堆石子中取走若干个石子；
> 2. 把一堆石子分成两堆非空石子。

其中一堆石子的 $SG$ 函数如下
| $x$    | 0   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | ... |
| ------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| $g(x)$ | 0   | 1   | 2   | 4   | 3   | 5   | 6   | 8   | 7   | ... |

即 $x$ 从 $1$ 开始后，每四个为一组，$SG$ 函数分别为 $4k+1,4k+2,4k+4,4k+3,k \ge 0$。

## 隐藏的Nim
以下游戏本质是 $Nim$ 游戏
1. 移动棋子：$n$ 个棋子位置分别为 $x_1,x_2,\dots,x_n$（两棋子位置可以相同），每次可以选择一个棋子向左移动 $\ge 1$ 格，且位置 $\ge 0$。
2. 取放石子：$n$ 堆石子大小分别为 $x_1,x_2,\dots,x_n$，每次可以选取两堆石子 $i < j$，把第 $i$ 堆石子移动一个到第 $j$ 堆。

## 取苹果游戏
> 共有 $n$ 堆苹果，其中第 $i$ 堆苹果有 $a_i$ 个，$a_i$ 个苹果排成一排，每次操作可以选取一段连续的苹果，若取完苹果后左右两端都有剩余，则认为左右两端的苹果分开成了两堆。

结论：对于一堆连续 $a$ 个苹果，$SG$ 函数 $sg(a) = a$ （同$Nim$游戏）

> 取苹果游戏扩展一：在取苹果游戏规则的基础上，限制每次取走的苹果个数在 $[l,r]$ 范围内

结论：单堆苹果 $sg(n) = \lfloor \frac{n}{l} \rfloor$

> 取苹果游戏扩展二：在取苹果游戏扩展一规则的基础上，规定初始每堆苹果各自形成了一个环。

结论：
$$
sg(n) = 
\begin{cases}
    \lfloor \frac{n}{l} \rfloor,& \text{if } n < l+r \\
    0, & \text{if } n\ge l+r
\end{cases}
$$

## 树上的$Green Hackenbush$游戏
[$Green Hackenbush$游戏参考](https://blog.sina.com.cn/s/blog_8f06da990101252l.html)
> 有一个森林，树的根节点都在地面上，每次选择一条边砍掉，此后边上连接的树枝全部掉落消失，无法操作的人输掉比赛。

结论：对于一棵树来说，自底向上分别求出每颗子树的 $SG$ 函数，计算方式为 $g(u) = \oplus_{v \in child_u} (g(v) + 1)$。

# 经典组合游戏

## Fibonacci Nim游戏
> $n$个石子，两玩家轮流取石子，先手第一次可取石子 $[1,n-1]$ 个，此后每次玩家取石子要满足
> - 取石子数量不能超过上一个人取走的石子数的两倍（至少取一个）。

结论：初始状态是 $P$ 态 $\iff$ $n$ 是一个 $Fibonacci$ 数，即 $F_1 = 1,F_2 = 2,3,5,8,\dots$。

$Zeckendorf$ 定理：每个正整数可以唯一分解成一些不相邻的 $Fibonacci$ 数的和，即 $n = F_{x_1} + F_{x_2} + \dots + F_{x_k}$，其中 $x_i \ge x_{i+1}+2,\forall i \in [1,k-1]$。

必胜策略略

## Chomp游戏
> $n*m$ 块饼干形成一个矩形形状，每次操作可以选一块还没吃的饼干，假设位于 $(i,j)$，玩家把 $(x,y),\forall x \ge i, y\ge j$ 的饼干全部吃掉，最后吃掉饼干 $(1,1)$ 的人输掉比赛。

结论：当前状态为 $P$ 态 $\iff$ $n=m=1$。
证明：假设先手选取 $(n,m)$ 后，后手如果存在必胜策略，选取了饼干 $(a,b)$，则先手第一步可以选取饼干 $(a,b)$ 来必胜。
必胜策略需要搜索轮廓线得到。

$Chomp$ 游戏扩展
> 设偏序集 $(S,\le)$，其中 $S$ 有限且存在最大元和最小元素，每次玩家可以选一个 $x \in S$，取走所有 $y,\forall x \le y,y\in S$，取到最小元的玩家输。
结论：如果 $|S| > 1$，先手必胜。

## Wythoff游戏
> 有两堆石子，大小分别为 $n,m$，每次玩家可以:
> 1. 从一堆取走若干个
> 2. 从两堆同时取走 $x$ 个（$x \le \min(n,m)$）

两堆石子分别有 $a,b$ 个，不妨设 $a \le b$，$P$ 态的情况如下：
| i     | 0   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | ... |
| ----- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| $a_i$ | 0   | 1   | 3   | 4   | 6   | 8   | 9   | 11  | ... |
| $b_i$ | 0   | 2   | 5   | 7   | 10  | 13  | 15  | 18  | ... |

结论：$a_i = \lfloor \Phi *i \rfloor$，$b_i = \lfloor \Phi^2 *i \rfloor$，其中 $\Phi = \frac{1+\sqrt{5}}{2}$ 是黄金分割比。

更进一步的，有以下结论（证明略）：
1. $a_i,b_i$是正整数的一个划分
2. $a_i = mex \{a_j,b_j,\forall j<i\}$
3. $b_i = a_i+i$
4. $(a,b),a<b$ 是 $P$ 态 $\iff$ 设 $i = b-a$，有 $a = \lfloor \Phi *i \rfloor$

> 在 $Wythoff$ 游戏中，如果必胜者想尽快结束游戏，而必败者反之，那么游戏会在多少步结束呢

结论：
1. 若当前状态 $(x,y)$ 是 $P$ 态，那么剩余回合数为 $2*|x-y|$
2. 若当前状态 $(x,y)$ 是 $N$ 态，那么下一步可以选择的 $P$ 态最多 $3$ 个。

代码实现上，可以记录 $id[a_i] = id[b_i] = i, \forall i \ge 1$，那么当前状态 $(x,y)$ 剩余回合数为
$$
    step = 
    \begin{cases}
        2*id_x,& \text{if } id_x = id_y \And x \neq y \\
        1+2*\min(id_x,id_y,|x-y|),& \text{otherwise}
    \end{cases}
$$


## 二分图博弈
### 博弈与二分图最大匹配
> 给定一个二分图和一个起始点 $H$，每次可以选择一个与当前点相邻，并且之前没有走过的节点，走到该节点，不能移动的玩家输掉比赛。

结论：如果该二分图的所有最大匹配上都有点 $H$，则先手必胜；否则后手必胜。
代码实现：$MaxMatching(G) = MaxMatching(G-\{H\}) \iff$ 后手必胜。
必胜策略
- 如果 $H$ 一定在最大匹配上，先手每次选取当前点的匹配点移动。可以证明当前点一定存在匹配点，否则可以返回找到一条两两匹配的路径，不包含点 $H$，且仍然是最大匹配，这与前提矛盾。
- 如果 $H$ 不在某个最大匹配 $M$ 上，不管先手走那个点，设为 $P$，后手可以按 $P$ 的匹配点来走。可以证明 $P$ 一定在匹配上，否则可以找到一条 $H$ 到 $P$ 的增广路，这说明不是此匹配不是最大匹配，矛盾。

### 二分图博弈在一般图的扩展
> 给定一个无向图，先手选取一个起点，删除它，随后轮流选取上一个点的相邻点进行删除，不能操作的玩家输。

结论
1. 该图的最大匹配为完美匹配 $\implies$ 不管先手选取哪个节点作为起点 $H$，$H$ 一定在最大匹配上 $\implies$ 后手必胜（策略同二分图博弈）
2. 该图的最大匹配不是完美匹配 $\implies$ 先手可以选取一个起点 $H$ 和一组最大匹配，$H$ 不在该最大匹配上 $\implies$ 先手必胜（策略同二分图博弈）

### 二分图最大匹配非必需点的寻找
定义非必需点为，存在某个最大匹配，该点没有匹配上。
求解方法有以下两种：
1. 求一组最大匹配，首先未匹配点必定是非必需点；然后对于每个匹配点进行考察，判断其配偶能否找到一条新的增广路，如果能，那么它是非必需点。复杂度 $O(n*m)$。
2. 求一组最大匹配，然后对于每个非匹配点，以该节点尝试寻找节点个数为奇数的增广路，那么增广路上奇数号位置的节点都是非必需点。使用数组对找过的节点标记，复杂度 $O(n+m)$。

## 有向图博弈技巧
> 每次玩家可以选取一条后继边，删除改边并把石头移动到后继节点，不能移动的玩家输。

小技巧：逐个消除图中的二元环。
因为不管玩家甲是为了赢还是为了延缓输的局面，玩家乙都会走反边以阻止对方。
就像阶梯博弈（$Nim$游戏变种）中，有人不遵守 $Nim$ 规则，移动了偶数位置的石子，对方能把石子重新移动到偶数位置来阻止这一行为。

# Nim积
## 翻硬币游戏
> 有一排硬币，硬币有 $Head$ 和 $Tail$ 两面，每次操作可以把某个 $H$ 翻转为 $T$，同时可以额外选择该硬币左边 $x$（$x=1$） 个位置的硬币进行翻转，不能操作的玩家输。

实际上就是 $Nim$ 游戏，当前局面可以表示为 $(x_1, x_2, \dots, x_k)$，其中 $x_i$ 是硬币面为 $H$ 的位置，它等价于 $k$ 个游戏 $(x_1),(x_2),\dots,(x_k)$ 的和。

此性质可以推广到任何规则的翻硬币游戏中，对于局面 $(x_1, x_2, \dots, x_k)$，有 $g(x_1, x_2, \dots, x_k) = g(x_1)\oplus g(x_2) \oplus \dots \oplus g(x_k)$。

> 将前面问题中的 $x$ 变为 $x=2$，即每次可以额外翻转两个硬币。

假设硬币位置从 $0$ 开始，$SG$ 函数 $g(x) = mex(\{0\} \cup \{g(i) | 0\le i < x\} \cup \{g(i) \oplus g(j) | 0 \le i < j < x\})$。

结论为 $g(x) = 2*x + [popcount(x) \% 2 = 0]$。

## 二维翻硬币游戏
> 有一个硬币矩阵，每次可以翻转一个矩形的四个角落 $(a,b),(a,y),(x,b),(x,y)$，其中 $0 \le a < x, 0 \le b < y,(x,y)$ 处的硬币是 $H$。

有 $g(x,y) = mex(\{g(x,b) \oplus g(a,y) \oplus g(a,b) | 0\le a < x, 0 \le b < y\})$。

左上角的 $SG$ 函数如下
| x\y | 0   | 1   | 2   | 3   | ... |
| --- | --- | --- | --- | --- | --- |
| 0   | 0   | 0   | 0   | 0   |
| 1   | 0   | 1   | 2   | 3   |
| 2   | 0   | 2   | 3   | 1   |
| 3   | 0   | 3   | 1   | 2   |
| ... |

## Nim积
定义$Nim$积 $x\otimes y = mex\{(x \otimes b) \oplus (a \otimes y) \oplus (a \otimes b)| 0\le a < x, 0 \le b < y\}$
有如下结论：
- $\otimes$ 具有交换率，结合律，单位元，逆元。
- $\otimes$ 对 $\oplus$ 具有分配律。
- $(N,\oplus,\otimes)$ 是一个域。

根据$Nim$和，$Nim$积的定义
- $a\oplus b = mex\{a^{'} \oplus b, a \oplus b^{'} | a^{'} < a, b^{'} < b\}$
- $a\otimes b = mex\{(a^{'} \oplus b) \otimes (a \oplus b^{'}) \otimes (a^{'} \oplus b^{'})| a^{'} < a, b^{'} < b\}$

可以扩展为，$A,B \subseteq N, mex(A) = a, mex(B) = b$，则
- $a\oplus b = mex\{a^{*} \oplus b, a \oplus b^{*} | a^{*} \in A, b^{*} \in B\}$
- $a\otimes b = mex\{(a^{*} \oplus b) \otimes (a \oplus b^{*}) \otimes (a^{*} \oplus b^{*})| a^{*} \in A, b^{*} \in B\}$

## Nim积的计算
### 基本计算方法
费马数 $Fermat$ $2-power$：$F_n = 2^{2^n}$，如 $F_0=2,F_1=4,F_2=16$。
- $F_n\otimes F_m = F_n * F_m, \text{if } n \neq m$
- $F_n\otimes F_n = \frac{3}{2}F_n$

$2^a \otimes 2^b$ 的计算
设 $a$ 的二进制表示下 $1$ 的位置集合为 $A$，$b$ 的二进制表示下 $1$ 的位置集合为 $B$，有
$$
  \begin{aligned}
    2^a \otimes 2^b &= (\otimes_{i \in A} 2^{2^i}) \otimes (\otimes_{j \in B} 2^{2^j}) \\
      &= (\prod_{k \in A \Delta B} 2^{2^k}) \otimes (\otimes_{p \in A \cap B}(2^{2^p} \oplus 2^{2^p -1}))
  \end{aligned}
$$

对于剩余 $\otimes$ 运算递归计算即可，复杂度 $O(\log a\log b)$。
更一般的 $a \otimes b$，将其进行二进制分解，按分配律计算。

### 更快的计算方式
> 计算 $x \otimes y$

考虑分治，设 $k$ 为满足 $2^{2^{k+1}} > \max(x,y)$ 的最小值，那么 $x = 2^{2^k} x_0 + x_1, y = 2^{2^k} y_0 + y_1$，其中 $x_0,x_1,y_0,y_1 < 2^{2^k}$。
有
$$
  \begin{aligned}
    x \otimes y &= (x_0 \otimes 2^{2^k} \oplus x_1) \otimes (y_0 \otimes 2^{2^k} \oplus y_1) \\
    &= (\frac{3}{2}2^{2^k} \otimes x_0 \otimes y_0) \oplus (2^{2^k} \otimes(x_0 \otimes y_1 \oplus y_0 \otimes x_1)) \oplus x_1 \otimes y_1 \\
    &= (x_1 \otimes y_1) \oplus (2^{2^k} \otimes ((x_0 \oplus x_1) \otimes (y_0 \oplus y_1) \oplus (x_1 \otimes y_1))) \oplus (2^{2^k-1} \otimes x_0 \otimes y_0)
  \end{aligned}
$$

式子中规定 $\otimes$ 运算符优先级大于 $\oplus$。
复杂度 $O(\log x\log y)$，由于 $x,y$ 很快变为 $0$，所以此方法速度相对较快。

## Nim积下的逆元
有两种方法：
1. 假设 $a < F_n$，有 $ a^{\otimes F_n-1} = 1$， 则 $a^{-1} = a^{\otimes F_n-2}$，其中 $a^{\otimes k} = a\otimes a \otimes \dots \otimes a$，表示 $k$ 个 $a$ 求$Nim$积。使用快速幂，复杂度 $O(\log^3 n)$。
2. $a^{-1} = mex(S)$，$S$ 由以下规则递归构造
   1. $0 \in S$
   2. 如果 $1 \le a^{'} < a, b \in S$，那么 $\frac{1\oplus ((a^{'}\oplus a) \otimes b)}{a^{'}} \in S$

## Nim积的其他结论
1. $(P_{F_n},\oplus,\otimes)$ 是一个域，其中 $P_N = \{0,1,\dots,N_1\}$
   - 元素在 $\oplus,\otimes$ 运算下封闭，即 $\forall x,y < F_n, x\otimes y < F_n, x\oplus y < F_n$。
   - 无零因子，即 $\forall x,y>0, x\otimes y \neq 0$。

2. 如果 $x < F_n$，那么 $x\otimes F_n = x*F_n$。
3. 在 $x\otimes y$的二维表上，取出行标和列标在 $[1, F_n-1]$ 范围内的子表，有
   - 每一行都是一个 $1 \sim F_n-1$ 的置换。
   - 每一列都是一个 $1 \sim F_n-1$ 的置换。
   - 左上到右下的对角线是一个 $1 \sim F_n-1$ 的置换。

## Nim积对应的组合游戏
假设 $G_1=(V_1,E_1),G_2=(V_2,E_2)$ 是两个翻硬币游戏，定义 $G_1 \times G_2$ 是两游戏的乘积，其状态集为 $V_1 \times V_2$，移动规则为，如果 $x \rightarrow x^{'}$ 和 $y \rightarrow y^{'}$ 分别在 $G_1,G_2$ 中合法，那么 $(x,y) \rightarrow (x^{'}, y^{'})$ 或者 $(x,y) \rightarrow (x, y^{'})$ 或者 $(x,y) \rightarrow (x^{'}, y)$。

$Tartan$ 定理
设 $G_1$ 和 $G_2$ 的 $SG$ 函数分别为 $g_1(x),g_2(x)$，则 $G_1\times G_2$ 的 $SG$ 函数为 $g(x,y) = g_1(x) \oplus g_2(y)$。